#!/bin/bash -eu

[ "$#" -eq 0 ] && exit 1

. /usr/local/subr/download.subr

CURL_OUTPUT=''

extract_class()
{
	grep -m"$1" -Eo "class=\"$2\"[^<]+" | sed -e 's/class=[^>]\+>//' -e '/^[ ,]*$/d'
}

for word in "$@"; do

	word="${word/./}"

	CURL_OUTPUT="$(curl_command "https://dictionary.cambridge.org/dictionary/spanish-english/${word}")"
	[ -z "$CURL_OUTPUT" ] && echo "- $word: [ERROR]" && continue
	echo "- $word"

	printf '%s meaning: \n%s\n' '--' "$(extract_class 3 'trans dtrans' <<< "$CURL_OUTPUT" | uniq | sed 's/^/@ /')"

	printf '%s syntaxis: \n%s\n' '--' "$(extract_class 2 '(pos dpos|gc dgc)' <<< "$CURL_OUTPUT" | sed 's/^/@ /')"

done
